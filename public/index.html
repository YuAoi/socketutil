<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>WebSocket Client</title>
    <style>
      * {
        box-sizing: border-box;
      }
      html,
      body {
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const socketMsg = document.querySelector("#socketMsg");
        // 连接 WebSocket 服务器
        const socket = new WebSocket(`ws://${window.location.host}`);

        socket.onopen = function () {
          console.log("Socket 连接成功");
        };

        // 接收来自服务器的消息
        socket.onmessage = function (event) {
          socketMsg.innerHTML += `<div>${event.data}</div>`;
        };

        // 发送消息到服务器
        document.body.addEventListener("click", function (event) {
          const target = event.target;
          if (target.className !== "sendButton") {
            return;
          }
          const targetmessage = document.querySelector(
            `.${target.dataset.message}`
          );
          const message = targetmessage.value;
          fetch("/send-message", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: message }),
          })
            .then((response) => response.text())
            .then((data) => console.log(data))
            .catch((error) => console.error("Error:", error));
        });

        // 清理消息记录
        document
          .querySelector("#clearButton")
          .addEventListener("click", function () {
            socketMsg.innerHTML = "";
          });
      });
    </script>
  </head>
  <body>
    <div style="display: flex">
      <div style="width: 500px">
        <div>
          <textarea
            style="width: 100%; height: 200px"
            class="messageInput1"
            placeholder="输入消息"
          ></textarea>
        </div>
        <div>
          <button class="sendButton" data-message="messageInput1">提交</button>
        </div>
        <div>
          <textarea
            style="width: 100%; height: 200px"
            class="messageInput2"
            placeholder="输入消息"
          ></textarea>
        </div>
        <div>
          <button class="sendButton" data-message="messageInput2">提交</button>
        </div>
        <div>
          <textarea
            style="width: 100%; height: 200px"
            class="messageInput3"
            placeholder="输入消息"
          ></textarea>
        </div>
        <div>
          <button class="sendButton" data-message="messageInput3">提交</button>
        </div>
      </div>
      <div style="flex: 1; padding: 10px; border: 1px solid #ccc">
        <div>Socket Message:</div>
        <div id="socketMsg"></div>
        <div><button id="clearButton">Clear</button></div>
      </div>
    </div>
  </body>
</html>
